<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eco Choice Island - Fixed</title>
<style>
/* åŸºç¤æ¨£å¼å’Œå­—é«”è¨­ç½® */
body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* æ›´æ”¹ç‚ºæ›´é€šç”¨çš„å­—é«” */
    background: #e6f7ff; /* è¼•å¾®ä¿®æ”¹èƒŒæ™¯è‰² */
    margin: 0; 
    padding: 20px; 
    display: flex;
    flex-direction: column;
    align-items: center;
}
h1 { 
    text-align: center; 
    font-size: 28px; 
    color: #00796b;
    margin-bottom: 5px;
}
/* ç‹€æ…‹æ¬„æ¨£å¼ï¼šä½¿ç”¨ Flexbox ç¢ºä¿å°é½Š */
.status { 
    display: flex; 
    flex-wrap: wrap; 
    justify-content: space-around; 
    margin: 15px 0; 
    font-size: 20px; 
    width: 100%;
    max-width: 600px;
    padding: 10px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.status div {
    padding: 0 10px;
}

/* å¡ç‰‡å®¹å™¨ï¼šä½¿ç”¨ Flexbox æˆ– Grid è®“å•†å“ä¸¦æ’é¡¯ç¤º */
#shop {
    display: grid;
    grid-template-columns: 1fr; /* é»˜èªå–®æ¬„ */
    gap: 20px;
    width: 100%;
    max-width: 700px;
    margin-top: 20px;
}
@media (min-width: 600px) {
    #shop {
        grid-template-columns: 1fr 1fr; /* å¯¬è¢å¹•æ™‚å…©æ¬„ */
    }
}

/* å–®å€‹å•†å“å¡ç‰‡æ¨£å¼ */
.card { 
    background: #ffffff; 
    border-radius: 12px; 
    padding: 20px; 
    box-shadow: 0 6px 10px rgba(0,0,0,0.1); 
    border: 1px solid #c8e6c9;
    transition: transform 0.2s;
}
.card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 15px rgba(0,0,0,0.15);
}

.card h3 { 
    font-size: 20px; 
    margin-top: 0; 
    color: #388e3c;
}
.card p {
    font-size: 16px;
    margin: 5px 0;
}

/* æŒ‰éˆ•æ¨£å¼ */
button { 
    width: 100%; 
    padding: 12px 0; 
    margin-top: 15px; 
    font-size: 17px; 
    border-radius: 10px; 
    border: none; 
    background-color: #66bb6a; 
    color: white; 
    cursor: pointer; 
    transition: background-color 0.2s;
}
button:hover:not(.disabled) {
    background-color: #43a047;
}
button.disabled { 
    background-color: #bdbdbd; 
    cursor: not-allowed; 
}

/* è¨Šæ¯å’Œçµæœé¡¯ç¤ºå€ */
#message {
    width: 100%;
    max-width: 600px;
    min-height: 40px;
    padding: 10px;
    margin-top: 10px;
    text-align: center;
    font-size: 16px;
    color: #d32f2f;
    font-weight: bold;
}
.footer { 
    margin-top: 25px; 
    text-align: center; 
    font-size: 14px; 
    color: #555; 
}
</style>
</head>
<body>

<h1>ğŸŒ± Eco Choice Island</h1>

<div class="status">
  <div>ğŸ’° Money: <span id="money">1000</span></div>
  <div>ğŸŒ Eco Points: <span id="eco">0</span></div>
</div>

<div id="message">Tip: Choose eco-friendly products to increase Eco Points!</div>

<div id="shop"></div>

<div class="footer">Game developed with simple HTML and JavaScript logic.</div>

<script>
let money = 1000;
let eco = 0;
let round = 0;
const shop = document.getElementById("shop");
const messageBox = document.getElementById("message");
const moneyDisplay = document.getElementById("money");
const ecoDisplay = document.getElementById("eco");

const groups = [
  [
    { name: "Disposable Correction Tape", cost: 20, eco: -5, desc: "Cheap and convenient, not eco-friendly." },
    { name: "Reusable Correction Tape", cost: 40, eco: 10, desc: "Refillable, good for the Earth." }
  ],
  [
    { name: "Plastic Building Blocks", cost: 500, eco: -15, desc: "Fun but made of plastic." },
    { name: "Wooden Building Blocks", cost: 700, eco: 20, desc: "Made of wood, eco-friendly." }
  ],
  [
    { name: "Individually Wrapped Egg Rolls", cost: 400, eco: -10, desc: "Lots of packaging waste." },
    { name: "Canned Egg Rolls", cost: 200, eco: 15, desc: "Less packaging, better for Earth." }
  ],
  [
    { name: "Bubble Tea in Plastic Cup", cost: 70, eco: -8, desc: "Convenient, but uses plastic." },
    { name: "Bubble Tea in Reusable Cup", cost: 60, eco: 12, desc: "Bring your own cup, eco-friendly." }
  ]
];

function updateStats() {
    moneyDisplay.innerText = money;
    ecoDisplay.innerText = eco;
}

function checkGameOver() {
    // æ¢ä»¶1: å›åˆæ•¸å·²æ»¿
    if (round >= groups.length) return true;
    
    // æ¢ä»¶2: éŒ¢ä¸å¤ è²·ç•¶å‰å›åˆæœ€ä¾¿å®œçš„å•†å“
    const currentCosts = groups[round].map(item => item.cost);
    const minCost = Math.min(...currentCosts);
    if (money < minCost) return true;

    return false;
}

function render() {
  updateStats();

  // æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ
  if (checkGameOver()) {
    let result = "";
    let color = "";
    if (eco >= 50) {
      result = "ğŸ‰ Eco Hero! You really care for the planet!";
      color = "#4caf50";
    }
    else if (eco >= 20) {
      result = "ğŸ™‚ Eco Learner! You are learning.";
      color = "#ff9800";
    }
    else {
      result = "âš ï¸ Eco Needs Help! Try better choices.";
      color = "#f44336";
    }

    shop.innerHTML = `
      <div class="card" style="grid-column: 1 / -1; text-align: center; border-color: ${color};">
        <h2>Game Over</h2>
        <p>Final Money left: ğŸ’° <strong>${money}</strong></p>
        <p>Final Eco Points: ğŸŒ <strong>${eco}</strong></p>
        <h3 style="color: ${color};">${result}</h3>
        <button onclick="location.reload()">ğŸ”„ Play Again</button>
      </div>
    `;
    messageBox.style.color = color;
    messageBox.innerText = "Game Ended!";
    return;
  }

  // æ¸²æŸ“ç•¶å‰å›åˆ
  shop.innerHTML = "";
  messageBox.style.color = '#1976d2';
  messageBox.innerText = `Round ${round + 1} of ${groups.length}: Make your choice!`;
  
  groups[round].forEach((item, index) => {
    const card = document.createElement("div");
    card.className = "card";
    const canBuy = money >= item.cost;
    const ecoColor = item.eco > 0 ? '#4caf50' : '#f44336'; 
    
    // æ³¨æ„ï¼šé€™è£¡çµ¦æŒ‰éˆ•åŠ äº†ä¸€å€‹ class æ–¹ä¾¿å¾ŒçºŒé¸å–ç¦ç”¨
    card.innerHTML = `
      <h3>${item.name}</h3>
      <p>${item.desc}</p>
      <p>
        ğŸ’° <strong>${item.cost}</strong> ï½œ 
        ğŸŒ <span style="color:${ecoColor};">${item.eco > 0 ? "+" : ""}${item.eco}</span>
      </p>
      <button class="choice-btn ${canBuy ? "" : "disabled"}" 
              ${canBuy ? "" : "disabled"} 
              onclick="chooseItem(${index})">
              Choose This
      </button>
    `;
    shop.appendChild(card);
  });
}

function chooseItem(index) {
  const item = groups[round][index];
  
  if (money < item.cost) {
    messageBox.style.color = '#d32f2f';
    messageBox.innerText = `Not enough money! Need ğŸ’°${item.cost}.`;
    return;
  }

  // 1. ç«‹å³ç¦ç”¨æ‰€æœ‰æŒ‰éˆ•ï¼Œé˜²æ­¢é€£é» (Fix Race Condition)
  const buttons = document.querySelectorAll('.choice-btn');
  buttons.forEach(btn => {
      btn.disabled = true;
      btn.classList.add('disabled');
      btn.innerText = "Processing...";
  });

  // 2. æ›´æ–°æ•¸æ“š
  money -= item.cost;
  eco += item.eco;
  
  // 3. ç«‹å³æ›´æ–°ä¸Šæ–¹çš„éŒ¢å’Œåˆ†æ•¸ (Fix UX Lag)
  updateStats();

  // 4. é¡¯ç¤ºçµæœè¨Šæ¯
  messageBox.style.color = '#00796b';
  messageBox.innerHTML = `You chose: <strong>${item.name}</strong>.`;

  // 5. å¢åŠ å›åˆæ•¸ä¸¦å»¶é²æ¸²æŸ“ä¸‹ä¸€é—œ
  round++;
  setTimeout(render, 800); // ç¨å¾®å»¶é•·ä¸€é»æ™‚é–“è®“ç”¨æˆ¶çœ‹æ¸…çµæœ
}

// åˆå§‹åŒ–
render();
</script>

</body>
</html>